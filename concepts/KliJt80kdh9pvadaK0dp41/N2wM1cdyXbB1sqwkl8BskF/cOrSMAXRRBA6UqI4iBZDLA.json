{
  "uri" : "local://cOrSMAXRRBA6UqI4iBZDLA/",
  "name" : "Concepts View",
  "category" : "",
  "parent" : "local://N2wM1cdyXbB1sqwkl8BskF/",
  "flags" : "U",
  "lvars" : [ {
    "name" : "model",
    "type" : "local://N2wM1cdyXbB1sqwkl8BskF/"
  } ],
  "vars" : [ {
    "name" : "htmlTemplate",
    "expr" : {
      "str" : "<html>\n    <head>\n        <link rel=\"stylesheet\" href=\"/resourcelocal://uC2K6qQB3q9Gm4QugYos19/\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/1.10.4/css/jquery.dataTables.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css\">\n        \n        <script src=\"js/knockout-3.2.0.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/1.10.4/js/jquery.dataTables.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.min.js\"></script>\n        \n        <meta name=\"cjsSaveMode\" content=\"auto\">\n        <meta name=\"cjsHeaderActive\" content=\"yes\">\n        \n    </head>\n\n    <body>\n        <div class=\"container concepts\">\n            <div class=\"row\">\n                <div class=\"col-md-8 search\">\n                    <div class=\"right-inner-addon \">\n                        <a class=\"hand\" data-bind=\"click : refreshSearch\"><i refId=\"search\" class=\"fa fa-search fa-lg\" ></i></a>\n                        <input type=\"text\" class=\"form-control search-input\" id=\"search\" placeholder=\"Type keyword to search Concepts, start with ':' to search by user/repo\" >\n                    </div>\n                </div>\n            </div>\n            <div class=\"row\">\n                <table id=\"conceptTable\" class=\"display\" cellspacing=\"0\" width=\"100%\">\n                    <thead>\n                        <tr>\n                            <th>User</th>\n                            <th>Repo</th>\n                            <th>ConceptName</th>\n                            <th>Location</th>\n                            <th>Exhibit</th>\n                            <th>Create Time</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    \n        <script> \n            var table;\n            \n            function ConceptsVM(){\n                var self = this;\n                \n                this.refresh = function(searchData, searchJson, sortJson){\n                    var prefixQuery = {\n                        \"match_phrase_prefix\": {\n                            \"repo\": {\n                                \"query\": searchData.substring(1),\n                                \"max_expansions\": 5\n                            }\n                        }\n                    }\n                    \n                    var processSearchJson = searchJson;\n                    if (searchData.indexOf(\":\") == 0){\n                        processSearchJson = prefixQuery;\n                    }\n                    \n                    console.log(\"search json:\"+JSON.stringify(processSearchJson));\n                    $cjs.searchConc({\n                        queryJson: processSearchJson,\n                        sortJson: sortJson,\n                        size: 600,\n                        done : function(data){\n                            //console.log(\"search data:\"+JSON.stringify(data));\n                            console.log(\"return rows:\"+data.hits.hits.length);\n\n                            table.clear();\n                            if (data.hits.total > 0){   \n                                _.each(data.hits.hits, function(x){\n                                    \n                                    var row = {};\n                                \n                                    row[0] = $cjs.getUserFromUri(x._source.uri);\n                                    row[1] = x._source.repo;\n                                    row[2] = '<a target=\"_blank\" href=\"/view'+x._source.uri+'\">'+x._source.name+'</a>';\n                                    row[3] = (x._source.breadcrumb)?x._source.breadcrumb.reverse().join(\"->\"):\"\";\n                                    \n                                    /*\n                                    row[4] = \"\";\n                                    \n                                    var createAt = $cjs.def(x._source.uri).createAt;\n                                    if (createAt){\n                                        row[5] = (new Date(createAt)).toISOString();\n                                    }else{\n                                        row[5] = \"\";\n                                    }\n                                        \n                                    table.row.add(row);\n                                    */\n                                    \n                                \n                                    $cjs.search({\n                                        uri: $cjs.uris.exhibitIndexEntryType,\n                                        queryJson: {\n                                            \"term\" : {\n                                                \"conceptUri\" : x._source.uri\n                                            }\n                                        },\n                                        done : function(data){\n                                            //console.log(\"search data:\"+JSON.stringify(data));\n                                            \n                                            if (data.hits.total > 0){   \n                                                row[4] = '<a target=\"_blank\" href=\"/view'+data.hits.hits[0]._source.uri+'\">'+data.hits.hits[0]._source.exhibitName+'</a>';\n                                            }else{\n                                                row[4] = \"\";\n                                            }\n                                        \n                                            var createAt = $cjs.def(x._source.uri).createAt;\n                                            if (createAt){\n                                                row[5] = (new Date(createAt)).toISOString();\n                                            }else{\n                                                row[5] = \"\";\n                                            }\n                                        \n                                            table.row.add(row);\n                                            table.draw();\n                                            \n                                        },\n                                        fail : function(jqXHR, textStatus, errorThrown){\n                                            console.log(\"failed to search concept value, response:\"+jqXHR.responseText);\n                                        }           \n                                    });\n                                    \n                                    \n                                });\n                            }\n                    \n                            \n                        },\n                        fail : function(jqXHR, textStatus, errorThrown){\n                            console.log(\"failed to search concept def, response:\"+jqXHR.responseText);\n                        }\n                    });\n                }\n                \n                this.refreshSearch = ko.pureComputed({\n                    read: function(){\n                        return \"\";\n                    },\n                    write: function(){\n                        var data = $(\"#search\").val();\n                        var searchJson;\n                        if (data){\n                            searchJson = {\n                                \"query_string\": { \n                                    \"query\" : data\n                                }\n                            };\n                        }else{\n                            searchJson = {\n                                \"match_all\": { }\n                            };\n                        }\n                        self.refresh(data, searchJson, null);\n                    },\n                    owner: this\n                });\n            }\n        \n            var conceptsVM = new ConceptsVM();\n            ko.applyBindings(conceptsVM);\n            \n            $(function () {\n                table = $('#conceptTable').DataTable( {\n                    \"order\": [[0, \"asc\"]],\n                    \"columns\": [\n                        { \"width\": \"10%\" },\n                        { \"width\": \"15%\" },\n                        { \"width\": \"20%\" },\n                        { \"width\": \"25%\" },\n                        { \"width\": \"20%\" },\n                        { \"width\": \"10%\" }\n                    ],\n                    \"dom\": 'T<\"clear\">lfrtip',\n                    \"tableTools\": {\n                        \"sSwfPath\": \"http://cdn.datatables.net/tabletools/2.2.3/swf/copy_csv_xls_pdf.swf\"\n                    }\n                });\n                \n                var username = \"{{username}}\";\n                if (username){\n                    $(\"#search\").val(\":/\"+username);\n                    conceptsVM.refreshSearch(\"\");\n                }\n            });\n        </script>\n    </body>\n</html>",
      "strEditMode" : "html",
      "type" : "STRING"
    }
  }, {
    "name" : "_page_propertyMap",
    "expr" : {
      "script" : "return { \"modelUri\" : model.uri(),\n         \"username\" : model.prop(\"username\").val() };",
      "type" : "SCRIPT"
    }
  }, {
    "name" : "page",
    "expr" : {
      "concept" : "/common/core/Xfh2VQ4HSK9klqbqqR-eBB/",
      "bindings" : {
        "htmlTemplate" : "htmlTemplate",
        "propertyMap" : "_page_propertyMap"
      },
      "type" : "CONCEPT"
    }
  } ],
  "isas" : [ {
    "var" : "page"
  } ],
  "encodedidxhash" : "",
  "isLambda" : true
}