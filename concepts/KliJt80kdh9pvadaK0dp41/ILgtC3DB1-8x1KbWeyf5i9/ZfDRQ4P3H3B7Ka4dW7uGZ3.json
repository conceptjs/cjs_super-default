{
  "uri" : "local://ZfDRQ4P3H3B7Ka4dW7uGZ3/",
  "name" : "User Statistics View",
  "category" : "",
  "parent" : "local://ILgtC3DB1-8x1KbWeyf5i9/",
  "flags" : "U",
  "lvars" : [ {
    "name" : "model",
    "type" : "local://ILgtC3DB1-8x1KbWeyf5i9/"
  } ],
  "vars" : [ {
    "name" : "htmlTemplate",
    "expr" : {
      "str" : "<html>\n    <head>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/1.10.9/css/jquery.dataTables.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css\">\n        \n        <script src=\"js/knockout-3.2.0.js\"></script>\n        <script src=\"js/view.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/1.10.9/js/jquery.dataTables.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.min.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"//cdnjs.cloudflare.com/ajax/libs/knockout.mapping/2.4.1/knockout.mapping.min.js\"></script>\n        \n        <script src=\"js/yoke_v2.min.js.gz\"></script>\n        \n        <style>\n            .userstatistics{\n                margin: 50px;\n            }\n        </style>\n        \n        \n    </head>\n\n    <body>\n        <div class=\"userstatistics\">\n            <div >\n                <table id=\"userStatTable\" class=\"display\" cellspacing=\"0\" width=\"100%\">\n                    <tfoot>\n                        <tr id=\"footerRow\">\n                        </tr>\n                    </tfoot>\n                </table>\n            </div>\n        </div>\n    \n        <script>\n            var table;\n            \n            var excludeUsers = [\"sridhar\", \"sridharyahoo\", \"yokedemo\", \"common\"];\n            \n            function getAllApp(userStatVM){\n                $cjs.search({\n                    uri: \"/common/yoke/OKTGX2refVA4Y4WY4LSFZF/\",\n                    queryJson: {\n                        \"match_all\" : {}\n                    },\n                    done : function(data){\n                        userStatVM.apps(_.sortBy(data.hits.hits, function(x){ return x._source.appName; }));\n                        \n                        for(var l=0;l<userStatVM.apps().length+2;l++){\n                            $(\"#footerRow\").append(\"<th></th>\");\n                        }\n                        \n                        $cjs.search({\n                            uri: \"/common/yoke/Zj66xRBTUtAzF4I1JhIuNA/\",\n                            queryJson: {\n                                \"match_all\" : {}\n                            },\n                            from: 0,\n                            size: 100000,\n                            done : function(data){\n                                var userStat = {};\n                                _.each(data.hits.hits, function(y){\n                                    var userName = y._source.uri.split(\"/\")[1];\n                                    var type = y._source.type;\n                                    \n                                    if ( _.indexOf(excludeUsers, userName) >= 0){\n                                        return;\n                                    }\n                                    \n                                    if (!userStat[userName]){\n                                        userStat[userName] = {};\n                                    }\n                                    var cardCT = userStat[userName][type];\n                                    if (!cardCT){\n                                        cardCT = 0;\n                                    }\n                                    userStat[userName][type] = cardCT+1;\n                                });\n                                \n                                var tableData = _.map(_.keys(userStat), function(u){\n                                    var newArray = _.map(userStatVM.apps(), function(v){ return (userStat[u][v._source.connectorType])?userStat[u][v._source.connectorType]:0; });\n                                    newArray.push(_.reduce(newArray, function(memo, num){ return memo + num; }));\n                                    newArray.unshift(u);\n                                    return newArray;\n                                })\n                                \n                                var columns = _.map(userStatVM.apps(), function(w){\n\t\t                            return { title: w._source.appName };\n\t\t                        });\n\t\t                        columns.push({ title: \"total\"})\n\t\t                        columns.unshift({ title: \"  User Name  \"});\n                                \n                                table = $('#userStatTable').DataTable( {\n                                    data: tableData,\n                                    \"autoWidth\": false,\n                                    columns: columns,\n                                    \"columnDefs\": [\n                                        { \"width\": \"100\", \"targets\": 0 }\n                                    ],\n\t\t                            \"order\": [[columns.length-1, \"desc\"]],\n\t\t                            \"iDisplayLength\": 100,\n                                    \"dom\": 'T<\"clear\">lfrtip',\n                                    \"tableTools\": {\n                                        \"sSwfPath\": \"https://cdn.datatables.net/tabletools/2.2.3/swf/copy_csv_xls_pdf.swf\",\n                                        \"aButtons\": [\n                                        {'sExtends':'copy',\n                                            \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                        },\n                                        {'sExtends':'csv',\n                                            \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                        },\n                                        {'sExtends':'xls',\n                                            \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                        },\n                                        {'sExtends':'pdf',\n                                            \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                        },\n                                        {'sExtends':'print',\n                                            \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                        }]\n                                    },\n                                    \"footerCallback\": function ( row, data, start, end, display ) {\n                                        var api = this.api(), data;\n                                        \n                                        for(var i=1;i<columns.length;i++){\n                                            var c = api.column(i);\n                                            var total = c.data().reduce(function(a,b){ return Number(a) + Number(b); });\n                                            $( c.footer() ).html( '<b>'+total+'</b>' );\n                                        }\n                                    }\n\t                            } );\n                            },\n                            fail : function(jqXHR, textStatus, errorThrown){\n                                options.fail(jqXHR, textStatus, errorThrown);\n                            }\n                        });\n                    },\n                    fail : function(jqXHR, textStatus, errorThrown){\n                        options.fail(jqXHR, textStatus, errorThrown);\n                    }\n                });\n            }\n            \n            function UserStatVM(){\n                var self = this;\n                \n                this.apps = ko.observableArray();\n\n            }\n            \n            $(function () {\n                var userStatVM = new UserStatVM();\n                ko.applyBindings(userStatVM);\n            \n                getAllApp(userStatVM);\n            });\n        </script>\n    </body>\n</html>",
      "strEditMode" : "html",
      "type" : "STRING"
    }
  }, {
    "name" : "_page_propertyMap",
    "expr" : {
      "script" : "return {\"modelUri\": model.uri()};",
      "type" : "SCRIPT"
    }
  }, {
    "name" : "page",
    "expr" : {
      "concept" : "/common/core/Xfh2VQ4HSK9klqbqqR-eBB/",
      "bindings" : {
        "htmlTemplate" : "htmlTemplate",
        "propertyMap" : "_page_propertyMap"
      },
      "type" : "CONCEPT"
    }
  } ],
  "isas" : [ {
    "var" : "page"
  } ],
  "encodedidxhash" : "",
  "isLambda" : true
}