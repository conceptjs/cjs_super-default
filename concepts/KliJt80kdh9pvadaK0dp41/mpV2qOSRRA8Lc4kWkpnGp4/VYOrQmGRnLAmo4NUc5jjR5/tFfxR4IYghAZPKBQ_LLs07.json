{
  "uri" : "local://tFfxR4IYghAZPKBQ_LLs07/",
  "name" : "Next Week Agenda View",
  "category" : "",
  "parent" : "local://VYOrQmGRnLAmo4NUc5jjR5/",
  "flags" : "U",
  "lvars" : [ {
    "name" : "model",
    "type" : "local://VYOrQmGRnLAmo4NUc5jjR5/"
  } ],
  "vars" : [ {
    "name" : "htmlTemplate",
    "expr" : {
      "str" : "<html>\n    <head>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/1.10.9/css/jquery.dataTables.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"css/select2/select2.min.css.gz\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"css/select2/select2-bootstrap.min.css.gz\">\n        \n        <script src=\"js/select2.min.js.gz\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/1.10.9/js/jquery.dataTables.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"https://cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.min.js\"></script>\n        <script type=\"text/javascript\" charset=\"utf8\" src=\"//cdnjs.cloudflare.com/ajax/libs/knockout.mapping/2.4.1/knockout.mapping.min.js\"></script>\n        \n        <script src=\"js/yoke_v2.min.js.gz\"></script>\n        \n        <style>\n            .nextweekagenda{\n                margin: 50px;\n            }\n            \n            .actions{\n                padding-bottom:50px;\n            }\n            \n            .noti-log-body{\n                height: 600px;\n                overflow-y: auto;\n            }\n        </style>\n        \n        \n    </head>\n\n    <body>\n        <div class=\"nextweekagenda\">\n            <div class=\"actions\">\n                <form class=\"form-inline\">\n                    <div class=\"form-group\">\n                        <label class=\"sr-only\" for=\"templates\">Templates</label>\n                        <input type=\"hidden\" class=\"form-control\" id=\"templates\" placeholder=\"Templates\">\n                    </div>\n                    <button type=\"submit\" class=\"btn btn-primary\" data-bind=\"click: sendNotifications\">Send Notifications</button>\n                </form>\n            </div>\n            <div >\n                <table id=\"nextWeekAgendaTable\" class=\"display\" cellspacing=\"0\" width=\"100%\">\n                </table>\n            </div>\n            \n            <div id=\"sendNoti-dialog-confirm\" tabindex=\"-1\" class=\"modal fade\" role=\"dialog\" data-bind=\"modal: sendNotiDialog.showDialog\">\n                <div class=\"modal-dialog\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>\n                            <h4 class=\"modal-title\">Send Notifications</h4>\n                        </div>\n\n                        <div class=\"modal-body\">\n                            <p><span class=\"fa fa-warning fa-lg\"></span>&nbsp; <span data-bind=\"html: sendNotiDialogMsg\"></span></p>\n                            <div class=\"modal-body noti-log-body\" data-bind=\"foreach: sendUsers\">\n                                <p data-bind=\"text: $data\"></p>\n                            </div>\n                        </div>\n\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\"><span class=\"glyphicon glyphicon-remove\"></span> Close</button>\n                            <button type=\"button\" class=\"btn btn-success\" data-bind=\"visible: needSubmit, click: sendTestEmail\"><span class=\"glyphicon glyphicon-ok\"></span> Send Test</button>\n                            <button type=\"button\" class=\"btn btn-success\" data-bind=\"visible: needSubmit, click: sendNotiDialog.submit\"><span class=\"glyphicon glyphicon-ok\"></span> Send</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div id=\"sendNoti-dialog-log\" tabindex=\"-1\" class=\"modal fade\" role=\"dialog\" data-bind=\"modal: sendNotiLog.showDialog\">\n                <div class=\"modal-dialog\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button>\n                            <h4 class=\"modal-title\">Notifications Logs</h4>\n                        </div>\n\n                        <div class=\"modal-body noti-log-body\" data-bind=\"foreach: logMsgs\">\n                            <p data-bind=\"text: $data\"></p>\n                        </div>\n\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\"><span class=\"glyphicon glyphicon-remove\"></span> Close</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    \n        <script>\n            var table;\n            \n            var excludeUsers = [\"common\", \"cjs_super\"];\n            \n            var userNextWeekAgendas = [];\n            \n            function capitalizeFirstLetter(string) {\n                return string.charAt(0).toUpperCase() + string.slice(1);\n            }\n            \n            function truncateName(name, length){\n                if (name.length <= length){\n                    return name;\n                }else{\n                    return name.substring(0, length)+\"...\";\n                }\n            }\n            \n            function isDateInNextWeek(date){\n\t            var nextWeek = moment().add(0, \"weeks\");\n\t            var startWeek = nextWeek.startOf(\"week\").valueOf();\n\t            var endWeek = nextWeek.endOf(\"week\").valueOf();\n\t            var dateValue = date.valueOf();\n\t            //console.logInfo(\"start week:\"+startWeek+\", end week:\"+endWeek);\n\t            //console.logInfo(\"date:\"+dateValue);\n\t            //console.logInfo(\"date in between:\" + (dateValue >= startWeek && dateValue <= endWeek));\n\t            return (dateValue >= startWeek && dateValue <= endWeek);\n            }\n            \n            function searchUsers(){\n                $cjs.search({\n                                uri: \"/common/admin/tJS-xy42lO8qF4twDxPmwF/\",\n                                queryJson: {\n                                    \"filtered\" : {\n    \t                                \"filter\" : {\n    \t                \t                \"bool\": {\n    \t                \t\t                \"must_not\": {\n    \t                \t\t\t                \"term\" : {\n        \t                    \t\t                \"name\" : \"private\"\n        \t                    \t                }\n    \t                \t\t                },\n    \t                \t\t                \"must\": [{\n    \t                \t\t                    \"missing\" : {\n    \t                \t\t                        \"field\" : \"notificationSelections.email\"  \n    \t                \t\t                    }\n    \t                \t\t                }]\n    \t                \t                }\n    \t                                }\n    \t                            }\n                                },\n                                from: 0,\n                                size: 10000,\n                                done : function(userSearchHit){\n                                    console.log(\"match users:\"+userSearchHit.hits.hits.length);\n                                    table = $('#nextWeekAgendaTable').DataTable( {\n                                            data: _.map(userSearchHit.hits.hits, function(x){ return [x._source.username, x._source.uri]; }),\n                                            \"autoWidth\": false,\n                                            columns: [{title: \"username\"}, {title: \"uri\"}],\n\t\t                                    \"order\": [[0, \"asc\"]],\n\t\t                                    \"iDisplayLength\": 100,\n                                            \"dom\": 'T<\"clear\">lfrtip',\n                                            \"tableTools\": {\n                                                \"sSwfPath\": \"https://cdn.datatables.net/tabletools/2.2.3/swf/copy_csv_xls_pdf.swf\",\n                                                \"aButtons\": [\n                                                {'sExtends':'copy',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'csv',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'xls',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'pdf',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'print',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                }]\n                                            }\n\t                                    } );\n\t                                    \n\t                                    table.draw();\n                                },\n                                fail : function(jqXHR, textStatus, errorThrown){\n                                    console.log(\"search user failed, status:\" + textStatus + \", error:\" + errorThrown + \", server response:\" + ((jqXHR.responseText)?jqXHR.responseText:\"\"));\n                                }\n                            });\n            }\n            \n            function drawTable(){\n                var nextWeek = moment().add(0, \"weeks\");\n                                        var columns = [ { title: \"Username\"}, { title: \"Email\"}, { title: nextWeek.startOf(\"week\").format(\"dddd, MMMM Do YYYY\")}, \n                                            { title: nextWeek.startOf(\"week\").add(1, \"days\").format(\"dddd, MMMM Do YYYY\")}, { title: nextWeek.startOf(\"week\").add(2, \"days\").format(\"dddd, MMMM Do YYYY\")}, \n                                            { title: nextWeek.startOf(\"week\").add(3, \"days\").format(\"dddd, MMMM Do YYYY\")}, { title: nextWeek.startOf(\"week\").add(4, \"days\").format(\"dddd, MMMM Do YYYY\")},\n                                            { title: nextWeek.startOf(\"week\").add(5, \"days\").format(\"dddd, MMMM Do YYYY\")}, { title: nextWeek.startOf(\"week\").add(6, \"days\").format(\"dddd, MMMM Do YYYY\")}];\n                                \n                                        table = $('#nextWeekAgendaTable').DataTable( {\n                                            data: userNextWeekAgendas,\n                                            \"autoWidth\": false,\n                                            columns: columns,\n\t\t                                    \"order\": [[0, \"asc\"]],\n\t\t                                    \"iDisplayLength\": 100,\n                                            \"dom\": 'T<\"clear\">lfrtip',\n                                            \"tableTools\": {\n                                                \"sSwfPath\": \"https://cdn.datatables.net/tabletools/2.2.3/swf/copy_csv_xls_pdf.swf\",\n                                                \"aButtons\": [\n                                                {'sExtends':'copy',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'csv',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'xls',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'pdf',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                },\n                                                {'sExtends':'print',\n                                                    \"oSelectorOpts\": { filter: 'applied', order: 'current' }\n                                                }]\n                                            }\n\t                                    } );\n\t                                    \n\t                                    table.draw();\n            }\n            \n            function getNextWeekAgendaUsers(userNextWeekAgendaVM){\n                $cjs.search({\n                    uri: \"/common/yoke/Eg73O4BYnD9d8q09JbHbyE/\",\n                    queryJson: {\n                        \"filtered\" : {\n    \t                    \"filter\" : {\n    \t                \t    \"term\": {\n    \t                \t\t    \"hasNextWeekEvents\": true\n    \t                \t    }\n    \t                    }\n    \t                }\n                    },\n                    from: 0,\n                    size: 10000,\n                    done : function(userDashboards){\n                        var userCT = 0;\n                        console.log(\"find users:\" + userDashboards.hits.hits.length);\n                        _.each(userDashboards.hits.hits, function(dashboard){ \n                            $cjs.search({\n                                uri: \"/common/admin/tJS-xy42lO8qF4twDxPmwF/\",\n                                queryJson: {\n                                    \"filtered\" : {\n    \t                                \"filter\" : {\n    \t                \t                \"bool\": {\n    \t                \t\t                \"must_not\": {\n    \t                \t\t\t                \"term\" : {\n        \t                    \t\t                \"name\" : \"private\"\n        \t                    \t                }\n    \t                \t\t                },\n    \t                \t\t                \"must\": {\n    \t                \t\t                    \"term\" : {\n    \t                \t\t                        \"username\" : $cjs.getUserFromUri(dashboard._source.uri)\n    \t                \t\t                    }\n    \t                \t\t                }\n    \t                \t                }\n    \t                                }\n    \t                            }\n                                },\n                                from: 0,\n                                size: 10000,\n                                done : function(userSearchHit){\n                                    var user = userSearchHit.hits.hits[0];\n                                    var notiSelection = user._source.notificationSelections;\n                            \n                                    var notiEnable = true;\n                                    if (notiSelection && notiSelection.email){\n                                        notiEnable = (_.indexOf(notiSelection.email, 1) >= 0);\n                                    }\n                            \n                                    userCT++;\n                                    console.log(\"userCT\"+userCT);\n                                    if (!notiEnable || _.indexOf(excludeUsers, user._source.username) >= 0 || user._source.username.indexOf(\"yoketao\") == 0){\n                                        if (!notiEnable){\n                                            console.log(user._source.username+\" has disable next week agenda email notification\");\n                                            $cjs(user._source.uri,{\n                                                evalAll: true\n                                            });\n                                            console.log(\"eval done!\");\n                                        }\n                                        if (userCT == userDashboards.hits.hits.length){\n                                            drawTable();\n                                        }\n                                        return;\n                                    }\n\n                                    var userNextWeekAgenda = [];\n                                    userNextWeekAgenda.push(user._source.username);\n                                    userNextWeekAgenda.push(user._source.email);\n  \n                                    var dayEvents = [];\n                                    _.each(_.keys(dashboard._source.nextWeekEvents.nextEvents), function(app){\n                                        _.each(_.values(dashboard._source.nextWeekEvents.nextEvents[app]), function(item){\n                                            var itemTime = moment(item.time);\n                                            var dayOfWeek = itemTime.weekday();\n                                            if (isDateInNextWeek(itemTime)){\n                                                var appEvents = dayEvents[dayOfWeek];\n                                                if (!appEvents){\n                                                    appEvents = [];\n                                                    dayEvents[dayOfWeek] = appEvents;\n                                                }\n                                            \n                                                item[\"type\"] = \"event\";\n                                                item[\"app\"] = app;\n                                                appEvents.push(item);\n                                            }\n                                        })    \n                                    });\n                                    \n                                    _.each(_.keys(dashboard._source.nextWeekEvents.dueEvents), function(app){\n                                        _.each(_.values(dashboard._source.nextWeekEvents.dueEvents[app]), function(item){\n                                            var itemTime = moment(item.time);\n                                            var dayOfWeek = itemTime.weekday();\n                                            if (isDateInNextWeek(itemTime)){\n                                                var appEvents = dayEvents[dayOfWeek];\n                                                if (!appEvents){\n                                                    appEvents = [];\n                                                    dayEvents[dayOfWeek] = appEvents;\n                                                }\n                                            \n                                                item[\"type\"] = \"due\";\n                                                item[\"app\"] = app;\n                                                appEvents.push(item);\n                                            }\n                                        })    \n                                    });\n                                    \n                                    userNextWeekAgenda = userNextWeekAgenda.concat(_.map(dayEvents, function(x){\n                                        return _.map(x, function(y){ return \"<a style=\\\"color:#333333;\\\" href=\\\"\"+y.url+\"\\\" target=\\\"_blank\\\">\"+truncateName(y.name, 50)+((y.type == \"due\")?\" is due\":\"\")+\"</a>\"; });\n                                    }));\n                                    \n                                    if (userNextWeekAgenda.length < 9){\n                                        for (i = userNextWeekAgenda.length; i < 9; i++) {\n                                            userNextWeekAgenda[i] = \"\";\n                                        }\n                                    }\n                                    \n                                    userNextWeekAgendas.push(userNextWeekAgenda);\n                                    \n                                    if (userCT == userDashboards.hits.hits.length){\n                                        drawTable();\n                                    }\n                                },\n                                fail : function(jqXHR, textStatus, errorThrown){\n                                    console.log(\"search user failed, status:\" + textStatus + \", error:\" + errorThrown + \", server response:\" + ((jqXHR.responseText)?jqXHR.responseText:\"\"));\n                                }\n                            });\n                        });\n                    },\n                    fail : function(jqXHR, textStatus, errorThrown){\n                        console.log(\"search dashboard failed, status:\" + textStatus + \", error:\" + errorThrown + \", server response:\" + ((jqXHR.responseText)?jqXHR.responseText:\"\"));\n                    }\n                });\n            }\n            \n            function UserNextWeekAgendaVM(){\n                var self = this;\n                \n                this.filteredUsers = ko.observableArray();\n                \n                this.emailClient = new $cjs.email.Client(\"MANDRILL\", {\"apiKey\": \"OXcdWVBVVOI5wosX5S5xGw\"});\n                \n                this.templateName = ko.observable();\n                this.sendNotiDialog = new DialogVM();\n                this.sendNotiLog = new DialogVM();\n                this.sendNotiDialogMsg = ko.observable(\"You are about to send next week agenda emails to all users listed above, are you sure?\");\n                this.logMsgs = ko.observableArray();\n                this.needSubmit = ko.observable(true);\n                \n                this.sendUsers = ko.computed(function(){\n                    return _.map(this.filteredUsers(), function(x){\n                       return x[1]; \n                    });\n                }, this)\n                \n                this.sendNotifications = function(){\n                    self.filteredUsers(self.filterUsers(userNextWeekAgendas));\n                    if (self.filteredUsers().length > 0){\n                        this.needSubmit(true);\n                        self.sendNotiDialogMsg(\"You are about to send next week agenda emails to the following \" + self.filteredUsers().length +\" users, are you sure?\")\n                        self.sendNotiDialog.show(function(){\n                            self.sendEmails();\n                        });\n                    }else{\n                        this.needSubmit(false);\n                        self.sendNotiDialogMsg(\"No users needs to send next week agenda to.\");\n                        self.sendNotiDialog.show(function(){\n                        });\n                    }\n                }\n                \n                this.sendTestEmail = function(){\n                    self.filteredUsers(_.filter(userNextWeekAgendas, function(x){\n                       return  x[0] == \"sridhar\";\n                    }));\n                    \n                    self.sendEmails();\n                }\n                \n                this.filterUsers = function(userNextWeekAgendas){\n                    return userNextWeekAgendas;\n                }\n                \n                this.sendEmails = function(){\n                    var paramStr = \"{{=<% %>=}}{\\\"template_name\\\": \\\"\"+self.templateName()+\"\\\",\\\"template_content\\\": [{\\\"name\\\":\\\"user next week agenda\\\", \\\"content\\\":\\\"user next week agenda\\\"}],\\\"message\\\" : {\\\"global_merge_vars\\\":[{\\\"name\\\" : \\\"USERID\\\",\\\"content\\\" : \\\"{{USERID}}\\\"},{\\\"name\\\" : \\\"DAY1\\\",\\\"content\\\" : {{{DAY1}}} },{\\\"name\\\" : \\\"DAY2\\\",\\\"content\\\" : {{{DAY2}}} },{\\\"name\\\" : \\\"DAY3\\\",\\\"content\\\" : {{{DAY3}}} },{\\\"name\\\" : \\\"DAY4\\\",\\\"content\\\" : {{{DAY4}}} },{\\\"name\\\" : \\\"DAY5\\\",\\\"content\\\" : {{{DAY5}}} },{\\\"name\\\" : \\\"DAY6\\\",\\\"content\\\" : {{{DAY6}}} },{\\\"name\\\" : \\\"DAY7\\\",\\\"content\\\" : {{{DAY7}}} },{\\\"name\\\" : \\\"DAY1_DATE\\\",\\\"content\\\" : \\\"{{DAY1_DATE}}\\\"},{\\\"name\\\" : \\\"DAY2_DATE\\\",\\\"content\\\" : \\\"{{DAY2_DATE}}\\\"},{\\\"name\\\" : \\\"DAY3_DATE\\\",\\\"content\\\" : \\\"{{DAY3_DATE}}\\\"},{\\\"name\\\" : \\\"DAY4_DATE\\\",\\\"content\\\" : \\\"{{DAY4_DATE}}\\\"},{\\\"name\\\" : \\\"DAY5_DATE\\\",\\\"content\\\" : \\\"{{DAY5_DATE}}\\\"},{\\\"name\\\" : \\\"DAY6_DATE\\\",\\\"content\\\" : \\\"{{DAY6_DATE}}\\\"},{\\\"name\\\" : \\\"DAY7_DATE\\\",\\\"content\\\" : \\\"{{DAY7_DATE}}\\\"},{\\\"name\\\" : \\\"DAY1_NAME\\\",\\\"content\\\" : \\\"{{DAY1_NAME}}\\\"},{\\\"name\\\" : \\\"DAY2_NAME\\\",\\\"content\\\" : \\\"{{DAY2_NAME}}\\\"},{\\\"name\\\" : \\\"DAY3_NAME\\\",\\\"content\\\" : \\\"{{DAY3_NAME}}\\\"},{\\\"name\\\" : \\\"DAY4_NAME\\\",\\\"content\\\" : \\\"{{DAY4_NAME}}\\\"},{\\\"name\\\" : \\\"DAY5_NAME\\\",\\\"content\\\" : \\\"{{DAY5_NAME}}\\\"},{\\\"name\\\" : \\\"DAY6_NAME\\\",\\\"content\\\" : \\\"{{DAY6_NAME}}\\\"},{\\\"name\\\" : \\\"DAY7_NAME\\\",\\\"content\\\" : \\\"{{DAY7_NAME}}\\\"}],\\\"from_email\\\" : \\\"admin@yoke.io\\\",\\\"to\\\": [{\\\"email\\\": \\\"{{EMAIL}}\\\"}],\\\"subject\\\": \\\"Agenda for next week\\\", \\\"merge_language\\\": \\\"handlebars\\\"}}<%={{ }}=%>\";\n                    self.sendNotiLog.show(function(){\n                    });\n                    var curTime = (new Date()).getTime();\n                    self.logMsgs([]);\n                    var nextWeek = moment().add(0, \"weeks\");\n                    var dates = [nextWeek.startOf(\"week\").date(), nextWeek.startOf(\"week\").add(1, \"days\").date(), nextWeek.startOf(\"week\").add(2, \"days\").date(),\n                    nextWeek.startOf(\"week\").add(3, \"days\").date(), nextWeek.startOf(\"week\").add(4, \"days\").date(), nextWeek.startOf(\"week\").add(5, \"days\").date(),\n                    nextWeek.startOf(\"week\").add(6, \"days\").date()];\n                    var dateNames = [nextWeek.startOf(\"week\").format(\"dddd\"), nextWeek.startOf(\"week\").add(1, \"days\").format(\"dddd\"), nextWeek.startOf(\"week\").add(2, \"days\").format(\"dddd\"),\n                    nextWeek.startOf(\"week\").add(3, \"days\").format(\"dddd\"), nextWeek.startOf(\"week\").add(4, \"days\").format(\"dddd\"), nextWeek.startOf(\"week\").add(5, \"days\").format(\"dddd\"),\n                    nextWeek.startOf(\"week\").add(6, \"days\").format(\"dddd\")];\n                    _.each(self.filteredUsers(), function(x){\n                        try{\n                            var userID = x[0];\n                            var email = x[1];\n                            var valueObj = {};\n                            for (i = 0; i < 7; i++) {\n                                valueObj[\"DAY\"+(i+1)] = JSON.stringify(x[i+2]);\n                                valueObj[\"DAY\"+(i+1)+\"_DATE\"] = dates[i];\n                                valueObj[\"DAY\"+(i+1)+\"_NAME\"] = dateNames[i];\n                            }\n                            valueObj[\"USERID\"]=userID;\n                            valueObj[\"EMAIL\"]=email;\n\n                            self.logMsgs.push(\"sending notification email to \"+email+\" ... \");\n                            var paramObj = JSON.parse(Mustache.render(paramStr, valueObj));\n                            self.emailClient.messages.sendTemplate(paramObj,function(data){\n                                self.logMsgs.push(\"sending notification email to \"+email+\": done!\");\n                            }, function(error1){\n                                self.logMsgs.push(\"send message error:\"+JSON.stringify(error1));\n                            });\n                            //self.logMsgs.push(\"params:\"+JSON.stringify(paramObj));\n                        }catch(error2){\n                            self.logMsgs.push(\"error:\"+error2);\n                        }\n                    });\n                }\n\n            }\n            \n            $(function () {\n                var userNextWeekAgendaVM = new UserNextWeekAgendaVM();\n                ko.applyBindings(userNextWeekAgendaVM);\n            \n                getNextWeekAgendaUsers(userNextWeekAgendaVM);\n                \n                userNextWeekAgendaVM.emailClient.templates.list({\"label\": \"yoke_agenda\"}, function(data){\n                    $(\"#templates\").select2({\n                        data: _.map(data, function(x, index, list){\n                            return { \"id\" : x.name, \"text\": x.name };\n                        }),\n                        width: '350px'\n                    }).on(\"change\", function(e) {\n                        userNextWeekAgendaVM.templateName($(\"#templates\").val());\n                    });\n                    \n                    $(\"#templates\").select2(\"val\",\"Yoke.io User Next Week Event Notification\", true);\n                },function(error){\n                    console.log(\"list email templates error:\"+JSON.stringify(error));\n                });\n                \n                //searchUsers();\n            });\n        </script>\n    </body>\n</html>",
      "strEditMode" : "html",
      "type" : "STRING"
    }
  }, {
    "name" : "_page_propertyMap",
    "expr" : {
      "script" : "return {\"modelUri\": model.uri()};",
      "type" : "SCRIPT"
    }
  }, {
    "name" : "page",
    "expr" : {
      "concept" : "/common/core/Xfh2VQ4HSK9klqbqqR-eBB/",
      "bindings" : {
        "htmlTemplate" : "htmlTemplate",
        "propertyMap" : "_page_propertyMap"
      },
      "type" : "CONCEPT"
    }
  } ],
  "isas" : [ {
    "var" : "page"
  } ],
  "encodedidxhash" : "",
  "isLambda" : true
}